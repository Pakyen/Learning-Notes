# 十七、信号量机制
[2019 王道考研 操作系统_哔哩哔哩 (゜-゜)つロ 干杯~-bilibili](https://www.bilibili.com/video/BV1YE411D7nH?p=21&spm_id_from=pageDriver)

![](%E5%8D%81%E4%B8%83%E3%80%81%E4%BF%A1%E5%8F%B7%E9%87%8F%E6%9C%BA%E5%88%B6/%E6%88%AA%E5%B1%8F2021-04-05%2011.11.12.png)

用户进程可以通过使用操作系统提供的**一对原语**来对**信号量**进行操作，从而很方便的实现了进程互斥、进程同步。

**信号量**其实就是一个变量，可以是用一个信号量来表示**系统中某种资源的数量**，比如系统中只有一台打印机，就可以设置一个初值为1的信号量

**原语**是一种特殊的程序段，其执行**只能一气呵成，不可被中断**，原语可由关中断/开中断指令实现

**一对原语**：**wait(S)**原语和**signal(S)**原语 ，可以把原语理解为函数，信号量S就是参数；wait、signal原语**简称为P、V操作**（P(S)、V(S)）

## 1. 整型信号量
	* 对信号量的操作只有三种， **初始化**、**P操作**、**V操作**。
	* wait原语：相当于进入区，申请资源
	* signal原语，相当于退出区，释放资源
![](%E5%8D%81%E4%B8%83%E3%80%81%E4%BF%A1%E5%8F%B7%E9%87%8F%E6%9C%BA%E5%88%B6/%E6%88%AA%E5%B1%8F2021-04-05%2012.15.57.png)

* 优点： **“检查”和“上锁”一气呵成，避免了并发、异步导致的问题**
* 缺点：**不满足“让权等待”原则，会发生“忙等”**（因为在wait原语中，while循环仍然在等待）


## 2. 记录型信号量
解决整型信号量“忙等”问题，用一个记录型数据结构来表示
![](%E5%8D%81%E4%B8%83%E3%80%81%E4%BF%A1%E5%8F%B7%E9%87%8F%E6%9C%BA%E5%88%B6/%E6%88%AA%E5%B1%8F2021-04-05%2012.27.04.png)
![](%E5%8D%81%E4%B8%83%E3%80%81%E4%BF%A1%E5%8F%B7%E9%87%8F%E6%9C%BA%E5%88%B6/%E6%88%AA%E5%B1%8F2021-04-05%2012.33.09.png)


* **S.value的初值**表示系统中**某些资源的数目**
* 当进程进行**P操作**时，s.value会减1，如果S.value<0，说明资源不够，就阻塞（运行态 -> 阻塞态），并加入等待队列，不会出现忙等
* 对一个信号量进行**V操作**，执行s.value++，此时还会使用wakeup原语唤醒等待队列中的资源，虽然此时value可能还<0，但是进程可以被唤醒后使用资源（阻塞态 -> 就绪态）


## 总结
![](%E5%8D%81%E4%B8%83%E3%80%81%E4%BF%A1%E5%8F%B7%E9%87%8F%E6%9C%BA%E5%88%B6/%E6%88%AA%E5%B1%8F2021-04-05%2012.37.44.png)




