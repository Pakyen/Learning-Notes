# 三十一、基本地址变换机构

## 1. 基本概念
基本地址变换机构可以借助进程的页表将逻辑地址转换为物理地址

通常会在系统中设置一个**页表寄存器(PTR)**，存放**页表在内存中的起始地址F**和**页表长度M**（页表长度M指的是一个进程的页表当中，有M个页表项，也就是说这个进程的页面有M页）

进程未执行时，页表的起始地址和页表长度**放在进程控制块(PCB)中**，当进程被调度时，操作系统内核会把它们放在页表寄存器中

注：**页面大小是2的整数幂**


## 2. 转换过程
设**页面大小为L**，逻辑地址A到物理地址E的变换过程如下：
![](%E4%B8%89%E5%8D%81%E4%B8%80%E3%80%81%E5%9F%BA%E6%9C%AC%E5%9C%B0%E5%9D%80%E5%8F%98%E6%8D%A2%E6%9C%BA%E6%9E%84/%E6%88%AA%E5%B1%8F2021-07-09%2017.58.48.png)
	1. 用逻辑地址A，计算页号P和页内偏移量W
	2. 对页号进行合法性检查：比较页号P和页表长度M，如果P>=M，则产生越界中断，否则继续执行（因为页号从0开始，所以P==M时也是越界）
	3. 页表中页号P对应的页表项地址 = 页表起始地址F + 页号P * 页表项长度，取出该页表项内容b，即为内存块号。
![](%E4%B8%89%E5%8D%81%E4%B8%80%E3%80%81%E5%9F%BA%E6%9C%AC%E5%9C%B0%E5%9D%80%E5%8F%98%E6%8D%A2%E6%9C%BA%E6%9E%84/%E6%88%AA%E5%B1%8F2021-07-09%2018.03.01.png)
	4. 计算 E = b*L + W

## 3. 例题
![](%E4%B8%89%E5%8D%81%E4%B8%80%E3%80%81%E5%9F%BA%E6%9C%AC%E5%9C%B0%E5%9D%80%E5%8F%98%E6%8D%A2%E6%9C%BA%E6%9E%84/AB6B811D-9B11-48B7-A3FC-197B0D9F7B95.png)


## 4. 小结
![](%E4%B8%89%E5%8D%81%E4%B8%80%E3%80%81%E5%9F%BA%E6%9C%AC%E5%9C%B0%E5%9D%80%E5%8F%98%E6%8D%A2%E6%9C%BA%E6%9E%84/B4DDA256-89CA-4C10-AD40-6ACFE1872E91.png)
