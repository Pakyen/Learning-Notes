# 十八、信号量机制实现进程互斥


## 1. 信号量机制实现进程互斥

1. 分析并发进程的关键活动，划定临界区（如：对临界资源打印机的访问就应放在临界区）
2. 设置**互斥信号量**mutex，初始值为1
3. 在临界区之前执行P(mutex)
4. 在临界区之后执行V(mutex)
![](%E5%8D%81%E5%85%AB%E3%80%81%E4%BF%A1%E5%8F%B7%E9%87%8F%E6%9C%BA%E5%88%B6%E5%AE%9E%E7%8E%B0%E8%BF%9B%E7%A8%8B%E4%BA%92%E6%96%A5/%E6%88%AA%E5%B1%8F2021-04-05%2013.11.26.png)
* **P、V操作必须成对出现**。缺少P(mutex)就不能保证临界资源的互斥访问。缺少V(mutex)会导致资源永不释放，等待进程永不被唤醒

## 2. 信号量机制实现进程同步
	
	1. 分析什么地方需要实现“同步关系”，即必须保证“一前一后”执行的两个操作（或两句代码）(因为异步性）
	2. 设置**同步信号量**S，**初始为0**
	3. **在“前操作”之后执行V(S)**
	4. **在“后操作”之前执行P(S)**

* 如我们需要让代码2在代码4之前运行
![](%E5%8D%81%E5%85%AB%E3%80%81%E4%BF%A1%E5%8F%B7%E9%87%8F%E6%9C%BA%E5%88%B6%E5%AE%9E%E7%8E%B0%E8%BF%9B%E7%A8%8B%E4%BA%92%E6%96%A5/9FBF7DAA-CBED-4626-BF0C-6B345D7F9D9B.png)



## 3. 信号量机制实现前驱关系

	1. 要**为每一对前驱关系各设置一个同步变量**
	2. **在“前操作”之后对相应的同步变量执行V操作**
	3. **在“后操作”之前对相应的同步变量执行P操作**

![](%E5%8D%81%E5%85%AB%E3%80%81%E4%BF%A1%E5%8F%B7%E9%87%8F%E6%9C%BA%E5%88%B6%E5%AE%9E%E7%8E%B0%E8%BF%9B%E7%A8%8B%E4%BA%92%E6%96%A5/%E6%88%AA%E5%B1%8F2021-04-05%2014.07.46.png)

## 总结
![](%E5%8D%81%E5%85%AB%E3%80%81%E4%BF%A1%E5%8F%B7%E9%87%8F%E6%9C%BA%E5%88%B6%E5%AE%9E%E7%8E%B0%E8%BF%9B%E7%A8%8B%E4%BA%92%E6%96%A5/%E6%88%AA%E5%B1%8F2021-04-05%2014.11.17.png)