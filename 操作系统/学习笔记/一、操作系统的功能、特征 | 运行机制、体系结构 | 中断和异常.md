# 一、操作系统的功能、特征 | 运行机制、体系结构 | 中断和异常

## 操作系统的功能
![](%E4%B8%80%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%81%E7%89%B9%E5%BE%81%20%7C%20%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E3%80%81%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%20%7C%20%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/%E6%88%AA%E5%B1%8F2021-03-24%2011.26.02.png)
![](%E4%B8%80%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%81%E7%89%B9%E5%BE%81%20%7C%20%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E3%80%81%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%20%7C%20%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/%E6%88%AA%E5%B1%8F2021-03-24%2011.26.32.png)

## 操作系统的特征
操作系统的特征有4个：并发、共享、虚拟、异步
其中**并发**和**共享**是两个最基本的特征，二者互为存在条件

1. **并发**：指两个或多个事件在**同一时间间隔**内发生。宏观上是同时发生的，微观上是交替发生的
	* 不要与并行混淆：并行指的是两个或多个事件在同一时刻发生

2. 共享
共享指的是资源共享，指系统中的资源可供内存中多个并发执行的进程共同使用
	* 互斥共享
		一个时间段内只允许一个进程访问该资源
		*如，使用qq和微信视频，摄像头同一时间内只能分配给一个进程*
	* 同时共享
		一个时间段内由多个进程“同时”对它们进行访问
		*如，使用qq和微信发文件，宏观上是同时发送文件，两个进程都在访问磁盘资源；微观上，是两个进程交替访问磁盘资源*
![](%E4%B8%80%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%81%E7%89%B9%E5%BE%81%20%7C%20%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E3%80%81%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%20%7C%20%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/%E6%88%AA%E5%B1%8F2021-03-24%2011.40.22.png)

![](%E4%B8%80%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%81%E7%89%B9%E5%BE%81%20%7C%20%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E3%80%81%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%20%7C%20%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/%E6%88%AA%E5%B1%8F2021-03-24%2011.43.16.png)

3. 虚拟
操作系统的虚拟技术科归纳为：
	* 空间复用技术：如虚拟存储器（从逻辑上扩充存储器容量，用户感觉到的但实际不存在的存储器）（如电脑内存为4G，但同时运行了需要多个文件，这些文件需要的总内存>4G）
	* 时分复用技术：如处理器的分时共享（分时来使用一个CPU，实际物理上只有一个CPU，但是用户感觉到有多个CPU）
	
4. 异步
多道程序环境允许多个程序**并发**执行，但由于资源有限，如cpu只有一个，进程的执行并不是一贯到底的，而是走走停停的，它以不可预知的速度向前推进。


### 操作系统的特征总结
![](%E4%B8%80%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%81%E7%89%B9%E5%BE%81%20%7C%20%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E3%80%81%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%20%7C%20%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/%E6%88%AA%E5%B1%8F2021-03-24%2011.54.20.png)

- - - -
# 二、操作系统的运行机制和体系结构
![](%E4%B8%80%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%81%E7%89%B9%E5%BE%81%20%7C%20%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E3%80%81%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%20%7C%20%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/%E6%88%AA%E5%B1%8F2021-03-24%2011.56.12.png)

## 1 运行机制
### 1.1 两种运行指令
	1. 特权指令：危险的指令，有一定权限
	2. 非特权指令：安全的指令，程序可以随便用

问：CPU怎么判断当前是否可以执行特权指令呢？
	这就引出了CPU的两种状态，用户态，还有核心态。

### 1.2 两种处理器状态
	1. 核心态
		而当CPU处于核心态时，CPU能执行非特权指令和特权指令。
	2. 用户态
		当CPU处于用户态时，CPU只能执行非特权指令,

问：那CPU怎么知道自己位于哪个状态呢？
	其实CPU中有一个寄存器 — **程序状态字寄存器(PSW)**，当该寄存器的值是0时，表示CPU处于用户态；而当为1时，表示CPU处于核心态。

### 1.3 两种程序
	1. 内核程序
		内核程序是操作系统的管理者，运行于核心态，所以可以执行特权指令和非特权指令
	2. 应用程序
		应用程序运行于用户态，只能执行非特权指令

 
## 2 操作系统内核
操作系统的内核分为两种，一种是大内核，一种是微内核
![](%E4%B8%80%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%81%E7%89%B9%E5%BE%81%20%7C%20%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E3%80%81%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%20%7C%20%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/5FD70CB5-029B-4EBE-84B9-C70C8DBC7346.png)
 原语是一种特殊的程序，是最接近硬件的部分，这种程序的运行具有原子性
  
![](%E4%B8%80%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%81%E7%89%B9%E5%BE%81%20%7C%20%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E3%80%81%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%20%7C%20%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/%E6%88%AA%E5%B1%8F2021-03-24%2012.15.59.png)


## 3 操作系统的体系结构
![](%E4%B8%80%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%81%E7%89%B9%E5%BE%81%20%7C%20%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E3%80%81%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%20%7C%20%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/%E6%88%AA%E5%B1%8F2021-03-24%2012.17.10.png)


- - - -
# 三、中断和异常

 

## 1. 中断
![](%E4%B8%80%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%81%E7%89%B9%E5%BE%81%20%7C%20%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E3%80%81%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%20%7C%20%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/%E6%88%AA%E5%B1%8F2021-03-24%2012.25.16.png)


## 1.1 中断与CPU状态的切换
问：用户态、核心态之间的切换时怎么实现的？
	“用户态 -> 核心态” 是通过**中断**实现的，并且中断是用户态切换到核心态的**唯一**途径

* 用户态 -> 核心态
	* **中断是用户态到核心态切换的唯一途径。**
* 核心态 -> 用户态
	* **核心态到用户态的切换只需要通过CPU执行一个特权指令，将程序状态字(PSW)的标志位设置为用户态。**

## 1.2 中断的分类
![](%E4%B8%80%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%81%E7%89%B9%E5%BE%81%20%7C%20%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E3%80%81%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%20%7C%20%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/%E6%88%AA%E5%B1%8F2021-03-24%2012.29.50.png)

 内中断的外中断的本质区别是**信号来源不同**
 ![](%E4%B8%80%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%81%E7%89%B9%E5%BE%81%20%7C%20%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E3%80%81%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%20%7C%20%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/%E6%88%AA%E5%B1%8F2021-03-24%2012.30.59.png)


## 1.3 外中断的处理过程
1. 执行完每条指令之后，CPU会**检查**当前是否有**外部中断信号**。

2. 如果检测到**外部中断信号** (比如打印机工作完成了)，则需要**保护**被中断进程的CPU环境 (如程序状态字PSW, 程序计数器PC,各种通用寄存器的值)。

3. 根据中断信号类型转入相应的**中断处理程序**。

4. **恢复**原进程的CPU环境并退出中断处理程序，返回原进程继续往下执行


## 总结
![](%E4%B8%80%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%81%E7%89%B9%E5%BE%81%20%7C%20%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E3%80%81%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%20%7C%20%E4%B8%AD%E6%96%AD%E5%92%8C%E5%BC%82%E5%B8%B8/%E6%88%AA%E5%B1%8F2021-03-24%2012.35.07.png)





 

