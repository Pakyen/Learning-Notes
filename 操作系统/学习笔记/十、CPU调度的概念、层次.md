# 十、CPU调度的概念、层次
![](%E5%8D%81%E3%80%81CPU%E8%B0%83%E5%BA%A6%E7%9A%84%E6%A6%82%E5%BF%B5%E3%80%81%E5%B1%82%E6%AC%A1/%E6%88%AA%E5%B1%8F2021-03-26%2021.07.32.png)


## 1. 调度的基本概念

处理机调度：在多道程序系统中，进程的数量往往是多于处理机个数的，这样就导致处理机不能并行的处理所有进程。处理机调度，就是从就绪队列中按照某种的算法选择一个进程并将处理机分配给它，以实现进程的并发运行



## 2. 调度的三个层次

### 2.1. 高级调度（作业调度）（外存 -> 内存）

> 我们知道是计算机的内存空间是有限，所以有时操作系统无法将用户提交的作业全部放入内存 (在单道批系统时)，因此操作系统就需要确定某种算法，决定作业调度内存的顺序  

**高级调度**，就是按某种算法在外存中处于后备队列的作业中挑选一个(或多个)作业，给它分配内存等必要资源，并建立相应的进程(建立PCB)，以使它(们)获得竞争处理机的权利

> 高级调度是外存与内存之间的调度。在这里，**每个作业只调入一次，调出一次**。作业调入时会建立相应的PCB，作业调出时才撤销PCB。高级调度主要是指**调入**的问题，因为只有调入的时机需要操作系统来确定，而调出的时机必然是作业运行结束后  
> 这种调度就好像刚刚的上厕所问题，厕所外的人处于后备队列，而高级调度的任务就类似把人从厕所外调入到厕所内  

![](%E5%8D%81%E3%80%81CPU%E8%B0%83%E5%BA%A6%E7%9A%84%E6%A6%82%E5%BF%B5%E3%80%81%E5%B1%82%E6%AC%A1/0404BFC6-3DD8-4BB1-BEBB-A75534C1F43E.png)


### 2.2. 中级调度（内存调度）（外存 -> 内存）

> 背景：在引入了虚拟存储技术之后，操作系统可将暂时不能运行的进程调至外存等待。等它重新具备了运行条件且内存稍有空闲时，操作系统再把它**调回**内存。  
> 这么做的目的是为了**提高内存利用率和系统吞吐量**  
>   
> 回顾一下，我们之前说过进程有几种状态，如 就绪态、阻塞态、运行态…，那被调到外存等待的进程处于什么状态呢？这些进程会处于**挂起态**。值得注意的，该进程的数据段和代码段会被调回外存，但PCB依旧会留在内存中的，并不会被调回外存，因为操作系统只有通过该进程的PCB，才能对其进行管理。**被挂起进程的PCB会被操作系统放到挂起队列中**。  

**中级调度，就是决定将哪个挂起状态的进程从外存重新调回内存**

* 注意和高级调度区分，虽然同样是从外存调到内存，但高级调度是**调入**，中级调度是**调回**

* 由于一个进程可能会被多次调出、调回内存，因此中级调度发生的**频率**要比高级调度的高

![](%E5%8D%81%E3%80%81CPU%E8%B0%83%E5%BA%A6%E7%9A%84%E6%A6%82%E5%BF%B5%E3%80%81%E5%B1%82%E6%AC%A1/4EADE9C6-A23F-489F-A1A4-4FE887C27E44.png)


#### 补充：进程的挂起状态与七状态模型

![](%E5%8D%81%E3%80%81CPU%E8%B0%83%E5%BA%A6%E7%9A%84%E6%A6%82%E5%BF%B5%E3%80%81%E5%B1%82%E6%AC%A1/93ED3DA7-B11D-4262-AB6C-D7A4EB30436E.png)注意：
	* **注意”挂起态”和”阻塞态”的区别，两种状态都是暂时不能获得CPU的服务，但挂起态是将进程实体(除PCB外)调到外存，而阻塞态的进程实体还留存在内存中。**

	* **有的操作系统不只把挂起态分为阻塞挂起和就绪挂起，甚至会根据阻塞原因的不同把阻塞挂起态的进程进一步细分为多个队列。**


### 2.3. 低级调度（进程调度）（内存 -> CPU）

**低级调度的主要任务是按照某种规则从就绪队列中选取一个进程，将CPU分配给它**

低级调度是操作系统中**最基本的一种调度**，在一般的操作系统中都必须配置低级调度。而且低级调度的**频率很高**，一般几十毫秒一次

![](%E5%8D%81%E3%80%81CPU%E8%B0%83%E5%BA%A6%E7%9A%84%E6%A6%82%E5%BF%B5%E3%80%81%E5%B1%82%E6%AC%A1/2B722ECC-B355-4450-9DFC-F6366B872164.png)



## 3. 三层调度的联系、对比
![](%E5%8D%81%E3%80%81CPU%E8%B0%83%E5%BA%A6%E7%9A%84%E6%A6%82%E5%BF%B5%E3%80%81%E5%B1%82%E6%AC%A1/%E6%88%AA%E5%B1%8F2021-03-26%2021.32.29.png)



## 小结
![](%E5%8D%81%E3%80%81CPU%E8%B0%83%E5%BA%A6%E7%9A%84%E6%A6%82%E5%BF%B5%E3%80%81%E5%B1%82%E6%AC%A1/%E6%88%AA%E5%B1%8F2021-03-26%2021.34.42.png)